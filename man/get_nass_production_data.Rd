% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_nass_production_data.R
\name{get_nass_production_data}
\alias{get_nass_production_data}
\title{Retrieve and Aggregate NASS Production Data}
\usage{
get_nass_production_data(
  dir_source = "./data-raw/fastscratch/nass/",
  source_desc = "SURVEY",
  agg_level_desc = c("NATIONAL", "STATE", "COUNTY")
)
}
\arguments{
\item{dir_source}{Character. Path to the directory where NASS Quick Stats raw QS files
are stored (default: \code{"./data-raw/fastscratch/nass/"}).}

\item{source_desc}{Character. The \code{source_desc} filter passed to NASS (e.g. \code{"SURVEY"}).}

\item{agg_level_desc}{Character vector. Which aggregation levels to include:
any combination of \code{"NATIONAL"}, \code{"STATE"}, and \code{"COUNTY"}.
Controls which code columns (\code{state_code}, \code{county_code}) are added.}
}
\value{
A \code{data.table} with one row per combination of:
\itemize{
\item \code{commodity_year}, \code{commodity_name},
\item chosen geographic codes (\code{state_code}, \code{county_code}),
\item plus any other aggregation keys.
Columns contain summed mean values for production and area.
}
}
\description{
This helper function cleans, and aggregates production and area data
from the USDA NASS Quick Stats API (via your \code{process_nass_dataset()} function),
for specified geographic aggregation levels (national, state, county).
It returns a \code{data.table} summarizing mean production and area by the chosen levels.
}
\details{
This function begins by constructing the set of grouping keys (\code{agg_level_list}), always
including the year, commodity name, aggregation descriptor, statistic category, and unit,
and then conditionally adding state and/or county codes if those levels are requested.
It then invokes \code{process_nass_dataset()} to fetch the raw crop data for the specified
source, sector, domain, country, frequency, reference period, statistic categories, and
aggregation levels. Once the data are loaded, any invalid or missing values are removed
and the mean of the remaining values is computed for each unique combination of metadata
columns. Four separate summaries are then generated: (1) overall production/utilization/class
totals, (2) breakdown by commodity class, (3) breakdown by utilization practice, and (4)
breakdown by production practice. These four summaries are merged back together, and any
rows with unwanted units (e.g., containing a dollar sign) or total rows in the commodity
name are filtered out. Next, area metrics are processed by selecting the first non-missing
sum across the four summaries and averaging it, and production metrics are handled similarly
after filtering out invalid unit-commodity combinations and converting cotton bale values
to pounds. Finally, the area and production results are bound together and summed across
the chosen grouping keys to produce the final \code{data.table}.
}
\seealso{
\itemize{
\item \code{\link{downloaded_nass_large_datasets}} - for downloading and caching USDA NASS Quick Stats large dataset files
\item \code{\link{process_nass_dataset}} - for retrieving raw NASS Quick Stats data
}
}
