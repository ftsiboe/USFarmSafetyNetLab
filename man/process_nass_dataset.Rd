% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/process_nass_dataset.R
\name{process_nass_dataset}
\alias{process_nass_dataset}
\title{Process a USDA NASS Quick Stats dataset by sector and statistic category}
\usage{
process_nass_dataset(
  dir_source = "./data-raw/fastscratch/nass/",
  large_dataset,
  statisticcat_desc = NULL,
  nassqs_params = NULL
)
}
\arguments{
\item{dir_source}{\code{character(1)}
\strong{Length 1.} Path to the directory where Quick Stats large datasets files are stored (and will be
downloaded to via \code{get_nass_large_datasets()}).  Defaults to \code{"./data-raw/fastscratch/nass/"}.}

\item{large_dataset}{\code{character(1)}
The Quick Stats \code{large_dataset} to load (e.g. \code{"crops"}). one of:
"census2002","census2007","census2012","census2017","census2022",
"census2007zipcode","census2017zipcode",
"animals_products","crops","demographics","economics","environmental"}

\item{statisticcat_desc}{\code{character(1)}
\strong{Length 1.} The Quick Stats \code{statisticcat_desc} to filter on (e.g. \code{"PRICE RECEIVED"}).
After aggregation, the resulting column of mean values will be renamed to
\code{gsub(" ", "_", statisticcat_desc)}.}

\item{nassqs_params}{\code{list} or \code{NULL}
A named list of additional Quick Stats API parameters to filter by (e.g.
\code{"domain_desc"}, \code{"agg_level_desc"}, \code{"year"}, etc.).  Names must correspond to
valid Quick Stats fields.  If \code{NULL} (the default), only \code{sector_desc} +
\code{statisticcat_desc} filtering is applied.  Use
\code{rnassqs::nassqs_params()} to list all valid parameter names.}
}
\value{
A \code{data.table} where:
\itemize{
\item All original columns have been lowercased.
\item Rows have been filtered by \code{nassqs_params}.
\item A \code{value} column has been converted to numeric (commas stripped), cleaned
of non-finite entries, and then aggregated by mean over the remaining columns.
\item That aggregated column is renamed to \code{gsub(" ", "_", statisticcat_desc)}.
\item Numeric code columns \code{state_code}, \code{country_code}, \code{asd_code}, plus
\code{commodity_year} and \code{commodity_name} have been created.
}
}
\description{
\code{process_nass_dataset()} downloads (if needed) and reads one or more NASS Quick Stats large datasets
files for a given sector, filters the rows by the chosen statistic category plus
any additional Quick Stats API parameters, converts and cleans the \code{value} column,
aggregates it by taking its mean over all remaining grouping columns, and then renames
that aggregated column to match the requested statistic.
}
\details{
The full set of valid Quick Stats API parameter names can be retrieved with:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{rnassqs::nassqs_params()
}\if{html}{\out{</div>}}
}
\examples{
\dontrun{
# National annual average price received for all CROPS in 2020:
dt1 <- process_nass_dataset(
  large_dataset       = "crops",
  statisticcat_desc = "PRICE RECEIVED",
  nassqs_params = list( agg_level_desc = "NATIONAL", year = 2020 ))

# State-level marketing-year average price for soybeans:
dt2 <- process_nass_dataset(
  large_dataset       = "crops",
  statisticcat_desc = "PRICE RECEIVED",
  nassqs_params     = list(
    agg_level_desc      = "STATE",
    short_desc          = "SOYBEANS - PRICE RECEIVED, MEASURED IN $ / BU",
    reference_period_desc = "MARKETING YEAR",
    freq_desc           = "ANNUAL"
  )
)
}
}
\seealso{
\itemize{
\item \code{get_nass_large_datasets()} for downloading the raw Quick Stats files
}

Other USDA NASS Quick Stats: 
\code{\link{downloaded_nass_large_datasets}()},
\code{\link{get_nass_census_data}()}
}
\concept{USDA NASS Quick Stats}
