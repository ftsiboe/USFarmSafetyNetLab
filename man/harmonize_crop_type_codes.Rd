% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helper_fcip.R
\name{harmonize_crop_type_codes}
\alias{harmonize_crop_type_codes}
\title{Harmonize and summarize crop type codes from raw SOBTPU data}
\usage{
harmonize_crop_type_codes()
}
\value{
A \code{data.frame} with columns:
\itemize{
\item \code{commodity_year}
\item \code{state_code}
\item \code{county_code}
\item \code{commodity_code}
\item \code{type_code}
\item \code{type_recode}
\item \code{data_source} (always "Summary of business by type, practice, and unit structure")
}
}
\description{
Download the raw Summary of Business by Type, Practice, and Unit Structure (SOBTPU)
data, clean and harmonize the crop type names for a fixed set of commodity codes,
determine a single dominant type per county, and save the resulting lookup table
of type renames.
}
\details{
This helper function performs the following steps:
\enumerate{
\item Downloads the raw SOBTPU data and reads it in.
\item Filters out rows with missing, zero, infinite, or NaN \code{liability_amount}, and
retains only the specified set of commodity codes (wheat, barley, rice, etc.).
\item Recodes \code{type_name} by commodity:
\itemize{
\item \strong{Wheat (11):} \code{"DURUM"}, \code{"SPRING"}, or \code{"NO TYPE SPECIFIED"}, dropping \code{"FORAGE WHEAT FOR SEED"}.
\item \strong{Barley (91):} \code{"SPRING"} or \code{"WINTER."}
\item \strong{Rice (18):} \code{"SHORT"}, \code{"LONG"}, \code{"MEDIUM"}, or \code{"NO TYPE SPECIFIED"}, dropping certain japonica types.
\item \strong{Other crops (41, 75, 94, 17, 81):} \code{"GRAIN"}, \code{"SILAGE"} (when \code{type_code == 26}), or "ALL".
}
\item Summarizes total \code{liability_amount} by \verb{(commodity_code, state_code, county_code, type_name)}.
\item Pivots to wide form, with one column per \code{type_name}, filling missing with zero.
\item Determines the single "dominant" type for each county-i.e. the one with positive liability
when all other types are zero.
\item Joins this \code{type_recode} back onto the full dataset and applies final cleanup:
\itemize{
\item If \code{type_name} is not \code{"NO TYPE SPECIFIED"}, it overrides the county-level rename.
\item Fills any remaining blanks or \code{NA} in \code{type_recode} with \code{"NO TYPE SPECIFIED"}.
}
\item Drops any residual invalid liability rows, selects and deduplicates the key columns,
adds a \code{data_source} column, saves to \code{./data-raw/type_recodes.rds}, and returns the result.
}
}
\examples{
\dontrun{
# Build and retrieve the lookup of harmonized crop types
lookup_dt <- harmonize_crop_type_codes()
}
}
